<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Trading Plan</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'navy-dark': '#1e3a5f',
                        'navy-medium': '#2c5282',
                        'blue-primary': '#3b82f6',
                        'blue-secondary': '#60a5fa',
                    }
                }
            }
        }
    </script>

    <style>
        /* Hide quick control on screen, show on print */
        .screen-hidden {
            display: none;
        }

        /* Custom styles for print */
        @media print {
            .no-print {
                display: none !important;
            }

            /* Hide everything except quick control when printing */
            body > div > div:not(.print-only),
            form,
            nav,
            header,
            .bg-navy-dark {
                display: none !important;
            }

            /* Show only quick control section */
            .print-only {
                display: block !important;
            }

            body {
                padding: 0;
                margin: 0;
                background: white;
            }

            .container {
                max-width: 100%;
                box-shadow: none;
            }

            .page-break {
                page-break-before: always;
            }

            /* Print-friendly colors */
            .bg-red-50 {
                background: white !important;
                border-color: black !important;
            }

            .bg-blue-50 {
                background: white !important;
                border-color: black !important;
            }

            .bg-slate-100 {
                background: white !important;
                border-color: black !important;
            }

            /* Ensure text is black for printing */
            .text-red-700,
            .text-orange-700,
            .text-blue-900,
            .text-slate-700,
            .text-slate-800 {
                color: black !important;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Animation for status message */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-message {
            animation: slideDown 0.3s ease-out;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen py-8 px-4">

    <!-- Main Container -->
    <div class="max-w-6xl mx-auto">

        <!-- Header -->
        <div class="bg-navy-dark rounded-t-lg shadow-lg px-8 py-6 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white tracking-wide">DAILY TRADING PLAN</h1>
            <div class="bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg">
                <span class="text-white/90 text-sm font-medium" id="current-date"></span>
            </div>
        </div>

        <!-- Status Message (hidden by default) -->
        <div id="status-message" class="hidden status-message mx-8 mt-4 px-4 py-3 rounded-lg text-sm font-medium">
            <!-- Content injected via JS -->
        </div>

        <!-- Form Container -->
        <div class="bg-white rounded-b-lg shadow-lg">

            <form id="daily-plan-form" class="divide-y divide-slate-200">

                <!-- ============================================ -->
                <!-- SECTION 1: PRE-MARKET ANALYSIS -->
                <!-- ============================================ -->
                <section class="p-8">
                    <div
                        class="bg-blue-primary text-white px-6 py-3 -mx-8 -mt-8 mb-6 font-semibold text-sm uppercase tracking-wider">
                        Pre-Market Analysis
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                        <!-- Market Regime -->
                        <div>
                            <label for="market-regime"
                                class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                                Market Regime
                            </label>
                            <select id="market-regime" name="marketRegime" required
                                class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-primary focus:border-transparent transition-all text-sm">
                                <option value="">Select...</option>
                                <option value="Trend Up">Trend Up</option>
                                <option value="Trend Down">Trend Down</option>
                                <option value="Range">Range</option>
                                <option value="Consolidation">Consolidation</option>
                                <option value="High Volatility">High Volatility</option>
                            </select>
                        </div>

                        <!-- Key Economic Events -->
                        <div>
                            <label class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                                Key Economic Events Today
                            </label>
                            <div class="grid grid-cols-2 gap-3 pt-1">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="events" value="CPI/PPI"
                                        class="w-4 h-4 text-blue-primary rounded focus:ring-2 focus:ring-blue-primary">
                                    <span class="text-sm text-slate-700">CPI/PPI</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="events" value="FOMC"
                                        class="w-4 h-4 text-blue-primary rounded focus:ring-2 focus:ring-blue-primary">
                                    <span class="text-sm text-slate-700">FOMC</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="events" value="Major Earnings"
                                        class="w-4 h-4 text-blue-primary rounded focus:ring-2 focus:ring-blue-primary">
                                    <span class="text-sm text-slate-700">Major Earnings</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="events" value="OpEx"
                                        class="w-4 h-4 text-blue-primary rounded focus:ring-2 focus:ring-blue-primary">
                                    <span class="text-sm text-slate-700">OpEx</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="events" value="Bond Auction"
                                        class="w-4 h-4 text-blue-primary rounded focus:ring-2 focus:ring-blue-primary">
                                    <span class="text-sm text-slate-700">Bond Auction</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="events" value="Other"
                                        class="w-4 h-4 text-blue-primary rounded focus:ring-2 focus:ring-blue-primary">
                                    <span class="text-sm text-slate-700">Other</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Primary Context -->
                    <div class="mt-6">
                        <label for="primary-context"
                            class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                            Primary Context
                        </label>
                        <textarea id="primary-context" name="primaryContext" rows="2"
                            placeholder="e.g. Above weekly pivot, testing monthly R1"
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-primary focus:border-transparent transition-all text-sm resize-none"></textarea>
                    </div>

                    <!-- Secondary Context -->
                    <div class="mt-6">
                        <label for="secondary-context"
                            class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                            Secondary Context
                        </label>
                        <textarea id="secondary-context" name="secondaryContext" rows="2"
                            placeholder="e.g. End of month rebalancing, FOMC week"
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-primary focus:border-transparent transition-all text-sm resize-none"></textarea>
                    </div>

                    <!-- Expected Volatility -->
                    <div class="mt-6">
                        <label for="expected-volatility"
                            class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                            Expected Volatility/ATR
                        </label>
                        <input type="text" id="expected-volatility" name="expectedVolatility"
                            placeholder="e.g. VIX: 18.5, SPY ATR: 5.2"
                            class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-primary focus:border-transparent transition-all text-sm">
                    </div>
                </section>

                <!-- ============================================ -->
                <!-- SECTIONS 2 & 3: TRADING PLAN + RISK (2 COLUMNS) -->
                <!-- ============================================ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-8">

                    <!-- LEFT COLUMN: TRADING PLAN -->
                    <section class="bg-white border border-slate-200 rounded-lg overflow-hidden">
                        <div class="bg-[#3b5998] text-white px-6 py-3 font-semibold text-sm uppercase tracking-wider">
                            Trading Plan
                        </div>

                        <div class="p-6 space-y-6">
                            <!-- A-Setup for Today -->
                            <div>
                                <label for="a-setup"
                                    class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                                    A-Setup for Today
                                </label>
                                <textarea id="a-setup" name="aSetup" rows="3"
                                    placeholder="Context + Trigger + Invalidation" required
                                    class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#3b5998] focus:border-transparent transition-all text-sm resize-none"></textarea>
                            </div>

                            <!-- Key Levels & Alerts -->
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-3">
                                    Key Levels & Alerts
                                </label>
                                <div class="grid grid-cols-3 gap-3">

                                    <!-- Resistance 2 -->
                                    <div>
                                        <label for="resistance-2"
                                            class="block text-xs font-semibold text-red-600 mb-1.5 uppercase">
                                            Resistance 2
                                        </label>
                                        <input type="number" step="0.01" id="resistance-2" name="resistance2"
                                            placeholder="0.00"
                                            class="w-full px-3 py-2 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-[#3b5998] focus:border-transparent">
                                    </div>

                                    <!-- Resistance 1 -->
                                    <div>
                                        <label for="resistance-1"
                                            class="block text-xs font-semibold text-red-600 mb-1.5 uppercase">
                                            Resistance 1
                                        </label>
                                        <input type="number" step="0.01" id="resistance-1" name="resistance1"
                                            placeholder="0.00"
                                            class="w-full px-3 py-2 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-[#3b5998] focus:border-transparent">
                                    </div>

                                    <!-- Pivot -->
                                    <div>
                                        <label for="pivot"
                                            class="block text-xs font-semibold text-indigo-600 mb-1.5 uppercase">
                                            Pivot
                                        </label>
                                        <input type="number" step="0.01" id="pivot" name="pivot" placeholder="0.00"
                                            class="w-full px-3 py-2 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-[#3b5998] focus:border-transparent">
                                    </div>

                                    <!-- Support 1 -->
                                    <div>
                                        <label for="support-1"
                                            class="block text-xs font-semibold text-green-600 mb-1.5 uppercase">
                                            Support 1
                                        </label>
                                        <input type="number" step="0.01" id="support-1" name="support1"
                                            placeholder="0.00"
                                            class="w-full px-3 py-2 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-[#3b5998] focus:border-transparent">
                                    </div>

                                    <!-- Support 2 -->
                                    <div>
                                        <label for="support-2"
                                            class="block text-xs font-semibold text-green-600 mb-1.5 uppercase">
                                            Support 2
                                        </label>
                                        <input type="number" step="0.01" id="support-2" name="support2"
                                            placeholder="0.00"
                                            class="w-full px-3 py-2 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-[#3b5998] focus:border-transparent">
                                    </div>

                                    <!-- VWAP/POC -->
                                    <div>
                                        <label for="vwap-poc"
                                            class="block text-xs font-semibold text-indigo-600 mb-1.5 uppercase">
                                            VWAP/POC
                                        </label>
                                        <input type="number" step="0.01" id="vwap-poc" name="vwapPoc" placeholder="0.00"
                                            class="w-full px-3 py-2 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-[#3b5998] focus:border-transparent">
                                    </div>
                                </div>
                            </div>

                            <!-- What I Will NOT Do Today -->
                            <div>
                                <label for="what-not-do"
                                    class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                                    What I Will NOT Do Today
                                </label>
                                <textarea id="what-not-do" name="whatNotDo" rows="3"
                                    placeholder="e.g. No revenge trades, no trading during lunch chop, no adding to losers"
                                    required
                                    class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#3b5998] focus:border-transparent transition-all text-sm resize-none"></textarea>
                            </div>

                            <!-- Mental State Check -->
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-3">
                                    Mental State Check
                                </label>
                                <div class="flex flex-wrap gap-4">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="mentalState" value="Focused" required
                                            class="w-4 h-4 text-[#3b5998] focus:ring-2 focus:ring-[#3b5998]">
                                        <span class="text-sm text-slate-700 font-medium">Focused</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="mentalState" value="Neutral"
                                            class="w-4 h-4 text-[#3b5998] focus:ring-2 focus:ring-[#3b5998]">
                                        <span class="text-sm text-slate-700 font-medium">Neutral</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="mentalState" value="Anxious"
                                            class="w-4 h-4 text-[#3b5998] focus:ring-2 focus:ring-[#3b5998]">
                                        <span class="text-sm text-slate-700 font-medium">Anxious</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="mentalState" value="Tired"
                                            class="w-4 h-4 text-[#3b5998] focus:ring-2 focus:ring-[#3b5998]">
                                        <span class="text-sm text-slate-700 font-medium">Tired</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- RIGHT COLUMN: RISK MANAGEMENT -->
                    <section class="bg-white border border-slate-200 rounded-lg overflow-hidden">
                        <div class="bg-[#3b5998] text-white px-6 py-3 font-semibold text-sm uppercase tracking-wider">
                            Risk Management
                        </div>

                        <div class="p-6 space-y-6">
                            <!-- Daily Risk Parameters -->
                            <div>
                                <h3 class="text-xs font-bold text-slate-700 uppercase tracking-wide mb-4">Daily Risk
                                    Parameters</h3>
                                <div class="space-y-3">

                                    <!-- Max Daily Loss -->
                                    <div class="grid grid-cols-2 gap-3 items-center">
                                        <label for="max-daily-loss" class="text-sm font-medium text-slate-700">
                                            Max Daily Loss
                                        </label>
                                        <div class="relative">
                                            <span class="absolute left-3 top-2.5 text-slate-400 text-sm">$</span>
                                            <input type="number" id="max-daily-loss" name="maxDailyLoss" placeholder=""
                                                required
                                                class="w-full pl-7 pr-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-[#3b5998] focus:border-transparent text-sm">
                                        </div>
                                    </div>

                                    <!-- Max Position Size -->
                                    <div class="grid grid-cols-2 gap-3 items-center">
                                        <label for="max-position-size" class="text-sm font-medium text-slate-700">
                                            Max Position Size
                                        </label>
                                        <input type="text" id="max-position-size" name="maxPositionSize"
                                            placeholder="shares/contracts"
                                            class="w-full px-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-[#3b5998] focus:border-transparent text-sm">
                                    </div>

                                    <!-- Max # of Trades -->
                                    <div class="grid grid-cols-2 gap-3 items-center">
                                        <label for="max-trades" class="text-sm font-medium text-slate-700">
                                            Max # of Trades
                                        </label>
                                        <input type="number" id="max-trades" name="maxTrades" value="5" required
                                            class="w-full px-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-[#3b5998] focus:border-transparent text-sm">
                                    </div>

                                    <!-- Profit Target -->
                                    <div class="grid grid-cols-2 gap-3 items-center">
                                        <label for="profit-target" class="text-sm font-medium text-slate-700">
                                            Profit Target
                                        </label>
                                        <div class="relative">
                                            <span class="absolute left-3 top-2.5 text-slate-400 text-sm">$</span>
                                            <input type="number" id="profit-target" name="profitTarget" placeholder=""
                                                class="w-full pl-7 pr-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-[#3b5998] focus:border-transparent text-sm">
                                        </div>
                                    </div>

                                    <!-- R per Trade -->
                                    <div class="grid grid-cols-2 gap-3 items-center">
                                        <label for="r-per-trade" class="text-sm font-medium text-slate-700">
                                            R per Trade
                                        </label>
                                        <input type="text" id="r-per-trade" name="rPerTrade" value="1%"
                                            class="w-full px-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-[#3b5998] focus:border-transparent text-sm">
                                    </div>
                                </div>
                            </div>

                            <!-- Circuit Breakers -->
                            <div class="bg-amber-50 border-2 border-amber-400 rounded-lg p-4">
                                <h4 class="text-xs font-bold text-amber-900 uppercase tracking-wide mb-3">Circuit
                                    Breakers</h4>
                                <div class="space-y-2.5">
                                    <label class="flex items-start space-x-2.5 cursor-pointer">
                                        <input type="checkbox" name="circuitBreaker1" value="2losses"
                                            class="mt-0.5 w-4 h-4 text-amber-600 rounded focus:ring-2 focus:ring-amber-500">
                                        <span class="text-sm text-amber-900">
                                            <strong>2 losses</strong> = 30min break
                                        </span>
                                    </label>
                                    <label class="flex items-start space-x-2.5 cursor-pointer">
                                        <input type="checkbox" name="circuitBreaker2" value="3losses" checked
                                            class="mt-0.5 w-4 h-4 text-red-600 rounded focus:ring-2 focus:ring-red-500">
                                        <span class="text-sm text-red-900 font-semibold">
                                            <strong>3 losses</strong> = done for day
                                        </span>
                                    </label>
                                    <label class="flex items-start space-x-2.5 cursor-pointer">
                                        <input type="checkbox" name="circuitBreaker3" value="maxhit" checked
                                            class="mt-0.5 w-4 h-4 text-red-600 rounded focus:ring-2 focus:ring-red-500">
                                        <span class="text-sm text-red-900 font-semibold">
                                            <strong>Daily max hit</strong> = close all
                                        </span>
                                    </label>
                                </div>
                            </div>

                            <!-- Time Restrictions -->
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-3">
                                    Time Restrictions
                                </label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="timeRestriction" value="first15min"
                                            class="w-4 h-4 text-[#3b5998] rounded focus:ring-2 focus:ring-[#3b5998]">
                                        <span class="text-sm text-slate-700">No trades first 15min</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="timeRestriction" value="lunch"
                                            class="w-4 h-4 text-[#3b5998] rounded focus:ring-2 focus:ring-[#3b5998]">
                                        <span class="text-sm text-slate-700">No trades 12-1pm</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="timeRestriction" value="flatBy"
                                            class="w-4 h-4 text-[#3b5998] rounded focus:ring-2 focus:ring-[#3b5998]">
                                        <span class="text-sm text-slate-700">Flat by 3:30pm</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- ============================================ -->
                    <!-- SECTION 4: SETUP EXECUTION TEMPLATE -->
                    <!-- ============================================ -->
                    <section class="p-8">
                        <div
                            class="bg-blue-primary text-white px-6 py-3 -mx-8 -mt-8 mb-6 font-semibold text-sm uppercase tracking-wider">
                            Setup Execution Template
                        </div>

                        <!-- Template Information -->
                        <div class="bg-slate-50 border-l-4 border-blue-primary rounded-r-lg p-5 space-y-4 mb-6">
                            <div>
                                <h4 class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-2">Context
                                    Requirements:</h4>
                                <p class="text-sm text-slate-700 leading-relaxed">
                                    HTF level present (weekly/daily/monthly pivot, TPO VAH/VAL/POC), liquidity
                                    identified
                                    above/below, regime appropriate (not "trend only" for mean reversion)
                                </p>
                            </div>

                            <div>
                                <h4 class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-2">Entry
                                    Triggers:
                                </h4>
                                <p class="text-sm text-slate-700 leading-relaxed">
                                    Price sweep + close back inside range | Footprint shows absorption at level | Delta
                                    divergence (fails to confirm new high/low) | Volume climax at extremes
                                </p>
                            </div>

                            <div>
                                <h4 class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-2">Invalidation
                                    Rules:</h4>
                                <p class="text-sm text-slate-700 leading-relaxed">
                                    Break beyond wick extreme by X ticks | Time stop: no movement in 15min | Context
                                    change
                                    (news, regime shift)
                                </p>
                            </div>

                            <div>
                                <h4 class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-2">Position
                                    Management:</h4>
                                <p class="text-sm text-slate-700 leading-relaxed">
                                    Entry: Market order on reclaim / Limit at retest | Scaling: Add only on first
                                    pullback
                                    if risk unchanged | Exits: Fixed target (VWAP/POC) or trailing stop on structure
                                    break
                                </p>
                            </div>
                        </div>

                        <!-- Today's Specific Setup Notes -->
                        <div>
                            <label for="setup-notes"
                                class="block text-xs font-bold text-slate-700 uppercase tracking-wide mb-2">
                                Today's Specific Setup Notes
                            </label>
                            <textarea id="setup-notes" name="setupNotes" rows="3"
                                placeholder="Customizations to template for today's market conditions"
                                class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-primary focus:border-transparent transition-all text-sm resize-none"></textarea>
                        </div>
                    </section>

            </form>

            <!-- ============================================ -->
            <!-- QUICK CONTROL SECTION (Print-friendly) -->
            <!-- ============================================ -->
            <section class="p-8 border-t-4 border-blue-primary screen-hidden print-only">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-slate-800">üìã CONTROL R√ÅPIDO</h2>
                    <p class="text-sm text-slate-500 mt-1" id="quick-control-date"></p>
                </div>

                <div class="space-y-6">
                    <!-- Max Daily Loss & Warning -->
                    <div class="bg-red-50 border-2 border-red-400 rounded-lg p-5">
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <p class="text-xs font-bold text-red-900 uppercase mb-2">Max Daily Loss</p>
                                <p class="text-4xl font-bold text-red-700" id="qc-max-loss">--</p>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-orange-900 uppercase mb-2">‚ö†Ô∏è Warning @ 80%</p>
                                <p class="text-4xl font-bold text-orange-700" id="qc-warning-threshold">--</p>
                            </div>
                        </div>
                    </div>

                    <!-- Actual P&L (Manual Entry) -->
                    <div class="bg-slate-100 border-2 border-slate-400 rounded-lg p-5">
                        <p class="text-xs font-bold text-slate-700 uppercase mb-3">Actual P&L (escribir a mano)</p>
                        <div class="bg-white border-2 border-slate-300 rounded-lg h-20"></div>
                    </div>

                    <!-- Max Trades Checkboxes -->
                    <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-5">
                        <p class="text-xs font-bold text-blue-900 uppercase mb-4">Trades (marcar al ejecutar)</p>
                        <div class="flex flex-wrap gap-4" id="qc-trades-checkboxes">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- Print Button (hidden when printing) -->
                    <div class="text-center no-print">
                        <button type="button" onclick="printQuickControl()"
                            class="px-8 py-3 bg-blue-primary text-white rounded-lg font-bold text-lg hover:bg-blue-secondary transition-all shadow-lg">
                            üñ®Ô∏è Imprimir Control R√°pido
                        </button>
                    </div>
                </div>
            </section>

            <!-- ============================================ -->
            <!-- ACTIONS BAR -->
            <!-- ============================================ -->
            <div class="bg-slate-50 px-8 py-6 no-print rounded-b-lg">
                <div class="flex justify-center items-center gap-3">
                    <button type="button" onclick="loadYesterdayPlan()"
                        class="px-5 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-lg font-medium text-sm hover:bg-slate-50 transition-all">
                        üìã Load Yesterday
                    </button>
                    <button type="button" onclick="clearForm()"
                        class="px-5 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-lg font-medium text-sm hover:bg-slate-50 transition-all">
                        üîÑ Reset
                    </button>
                    <button type="button" onclick="window.print()"
                        class="px-5 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-lg font-medium text-sm hover:bg-slate-50 transition-all">
                        üñ®Ô∏è Print
                    </button>
                    <button type="button" onclick="savePlan()"
                        class="px-6 py-2.5 bg-[#3b5998] text-white rounded-lg font-semibold text-sm hover:bg-[#2d4373] transition-all shadow-lg">
                        üíæ Save Plan
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- ============================================ -->
    <!-- JAVASCRIPT -->
    <!-- ============================================ -->
    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const CONFIG = {
            storageKey: 'daily-plan-today',
            timezone: 'America/Sao_Paulo' // BRT
        };

        // ==========================================
        // INITIALIZATION
        // ==========================================
        window.addEventListener('DOMContentLoaded', async function () {
            // Set current date
            setCurrentDate();

            // Load today's plan if exists
            await loadTodayPlan();

            // Setup form validation
            setupFormValidation();

            // Load quick control
            loadQuickControl();

            console.log('‚úÖ Daily Plan initialized');
        });

        // ==========================================
        // DATE MANAGEMENT
        // ==========================================
        function setCurrentDate() {
            const today = new Date();
            const options = {
                month: '2-digit',
                day: '2-digit',
                year: 'numeric',
                timeZone: CONFIG.timezone
            };
            const dateStr = today.toLocaleDateString('en-US', options);
            document.getElementById('current-date').textContent = dateStr;
        }

        function getTodayDateKey() {
            const today = new Date();
            return today.toISOString().split('T')[0]; // YYYY-MM-DD
        }

        function getYesterdayDateKey() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            return yesterday.toISOString().split('T')[0];
        }

        // ==========================================
        // SAVE PLAN
        // ==========================================
        async function savePlan() {
            const form = document.getElementById('daily-plan-form');

            // Validate required fields
            if (!form.checkValidity()) {
                showMessage('Please fill all required fields', 'warning');
                form.reportValidity();
                return;
            }

            try {
                const plan = buildPlanObject();

                // Save to window.storage (today)
                await window.storage.set(CONFIG.storageKey, JSON.stringify(plan));

                // Save to history (with date)
                const historyKey = `daily-plan-${plan.date}`;
                await window.storage.set(historyKey, JSON.stringify(plan));

                showMessage('‚úÖ Plan saved successfully!', 'success');

                console.log('‚úÖ Plan saved:', plan);

            } catch (error) {
                console.error('Error saving plan:', error);
                showMessage('‚ùå Error saving plan: ' + error.message, 'error');
            }
        }

        function buildPlanObject() {
            const form = document.getElementById('daily-plan-form');
            const formData = new FormData(form);

            return {
                version: '1.0',
                date: getTodayDateKey(),
                timestamp: new Date().toISOString(),

                // Pre-Market Analysis
                marketRegime: formData.get('marketRegime'),
                events: formData.getAll('events'),
                primaryContext: formData.get('primaryContext'),
                secondaryContext: formData.get('secondaryContext'),
                expectedVolatility: formData.get('expectedVolatility'),

                // Trading Plan
                aSetup: formData.get('aSetup'),
                levels: {
                    resistance2: formData.get('resistance2') || null,
                    resistance1: formData.get('resistance1') || null,
                    pivot: formData.get('pivot') || null,
                    support1: formData.get('support1') || null,
                    support2: formData.get('support2') || null,
                    vwapPoc: formData.get('vwapPoc') || null
                },
                whatNotDo: formData.get('whatNotDo'),
                mentalState: formData.get('mentalState'),

                // Risk Management
                maxDailyLoss: formData.get('maxDailyLoss'),
                maxPositionSize: formData.get('maxPositionSize'),
                maxTrades: formData.get('maxTrades'),
                profitTarget: formData.get('profitTarget'),
                rPerTrade: formData.get('rPerTrade'),
                circuitBreakers: {
                    twoLosses: formData.get('circuitBreaker1') === 'on',
                    threeLosses: formData.get('circuitBreaker2') === 'on',
                    maxHit: formData.get('circuitBreaker3') === 'on'
                },
                timeRestrictions: formData.getAll('timeRestriction'),

                // Setup Notes
                setupNotes: formData.get('setupNotes')
            };
        }

        // ==========================================
        // LOAD PLAN
        // ==========================================
        async function loadTodayPlan() {
            try {
                const result = await window.storage.get(CONFIG.storageKey);

                if (result && result.value) {
                    const plan = JSON.parse(result.value);

                    // Verify it's from today
                    if (plan.date === getTodayDateKey()) {
                        fillFormWithPlan(plan);
                        showMessage('üìã Loaded today\'s plan', 'info');
                        console.log('‚úÖ Loaded plan:', plan);
                    }
                }
            } catch (error) {
                console.log('No plan for today');
            }
        }

        async function loadYesterdayPlan() {
            try {
                const yesterdayKey = `daily-plan-${getYesterdayDateKey()}`;
                const result = await window.storage.get(yesterdayKey);

                if (result && result.value) {
                    const plan = JSON.parse(result.value);

                    if (confirm('Load yesterday\'s plan as template?')) {
                        fillFormWithPlan(plan);
                        showMessage('üìã Loaded yesterday\'s plan', 'info');
                    }
                } else {
                    showMessage('No plan found for yesterday', 'warning');
                }
            } catch (error) {
                showMessage('Error loading yesterday\'s plan', 'error');
                console.error(error);
            }
        }

        function fillFormWithPlan(plan) {
            const form = document.getElementById('daily-plan-form');

            // Pre-Market Analysis
            if (plan.marketRegime) form.marketRegime.value = plan.marketRegime;
            if (plan.events) {
                plan.events.forEach(event => {
                    const checkbox = form.querySelector(`input[name="events"][value="${event}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            if (plan.primaryContext) form.primaryContext.value = plan.primaryContext;
            if (plan.secondaryContext) form.secondaryContext.value = plan.secondaryContext;
            if (plan.expectedVolatility) form.expectedVolatility.value = plan.expectedVolatility;

            // Trading Plan
            if (plan.aSetup) form.aSetup.value = plan.aSetup;
            if (plan.levels) {
                if (plan.levels.resistance2) form.resistance2.value = plan.levels.resistance2;
                if (plan.levels.resistance1) form.resistance1.value = plan.levels.resistance1;
                if (plan.levels.pivot) form.pivot.value = plan.levels.pivot;
                if (plan.levels.support1) form.support1.value = plan.levels.support1;
                if (plan.levels.support2) form.support2.value = plan.levels.support2;
                if (plan.levels.vwapPoc) form.vwapPoc.value = plan.levels.vwapPoc;
            }
            if (plan.whatNotDo) form.whatNotDo.value = plan.whatNotDo;
            if (plan.mentalState) {
                const radio = form.querySelector(`input[name="mentalState"][value="${plan.mentalState}"]`);
                if (radio) radio.checked = true;
            }

            // Risk Management
            if (plan.maxDailyLoss) form.maxDailyLoss.value = plan.maxDailyLoss;
            if (plan.maxPositionSize) form.maxPositionSize.value = plan.maxPositionSize;
            if (plan.maxTrades) form.maxTrades.value = plan.maxTrades;
            if (plan.profitTarget) form.profitTarget.value = plan.profitTarget;
            if (plan.rPerTrade) form.rPerTrade.value = plan.rPerTrade;

            if (plan.circuitBreakers) {
                form.circuitBreaker1.checked = plan.circuitBreakers.twoLosses || false;
                form.circuitBreaker2.checked = plan.circuitBreakers.threeLosses || false;
                form.circuitBreaker3.checked = plan.circuitBreakers.maxHit || false;
            }

            if (plan.timeRestrictions) {
                plan.timeRestrictions.forEach(restriction => {
                    const checkbox = form.querySelector(`input[name="timeRestriction"][value="${restriction}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            // Setup Notes
            if (plan.setupNotes) form.setupNotes.value = plan.setupNotes;
        }

        // ==========================================
        // CLEAR FORM
        // ==========================================
        function clearForm() {
            if (confirm('Clear all fields? This will not delete saved plans.')) {
                document.getElementById('daily-plan-form').reset();
                showMessage('Form cleared', 'info');
            }
        }

        // ==========================================
        // FORM VALIDATION
        // ==========================================
        function setupFormValidation() {
            const form = document.getElementById('daily-plan-form');

            // Real-time validation feedback
            const requiredFields = form.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                field.addEventListener('blur', function () {
                    if (!this.value) {
                        this.classList.add('border-red-400');
                    } else {
                        this.classList.remove('border-red-400');
                    }
                });
            });
        }

        // ==========================================
        // STATUS MESSAGE
        // ==========================================
        function showMessage(text, type) {
            const messageEl = document.getElementById('status-message');

            // Remove existing classes
            messageEl.className = 'status-message px-4 py-3 rounded-lg text-sm font-medium';

            // Add type-specific classes
            if (type === 'success') {
                messageEl.classList.add('bg-green-50', 'text-green-800', 'border', 'border-green-200');
            } else if (type === 'error') {
                messageEl.classList.add('bg-red-50', 'text-red-800', 'border', 'border-red-200');
            } else if (type === 'warning') {
                messageEl.classList.add('bg-amber-50', 'text-amber-800', 'border', 'border-amber-200');
            } else {
                messageEl.classList.add('bg-blue-50', 'text-blue-800', 'border', 'border-blue-200');
            }

            messageEl.textContent = text;
            messageEl.classList.remove('hidden');

            // Auto-hide after 3 seconds
            setTimeout(() => {
                messageEl.classList.add('hidden');
            }, 3000);
        }

        // ==========================================
        // MOCK window.storage FOR DEVELOPMENT
        // ==========================================
        // This will be replaced with real window.storage API later
        if (typeof window.storage === 'undefined') {
            console.warn('‚ö†Ô∏è window.storage not available. Using localStorage fallback for development.');

            window.storage = {
                async get(key) {
                    const value = localStorage.getItem(key);
                    return value ? { key, value } : null;
                },
                async set(key, value) {
                    localStorage.setItem(key, value);
                    return { key, value };
                },
                async delete(key) {
                    localStorage.removeItem(key);
                    return { key, deleted: true };
                }
            };
        }

        // ==========================================
        // EXPORT FOR EXTERNAL ACCESS
        // ==========================================
        window.getDailyPlan = async function () {
            const result = await window.storage.get(CONFIG.storageKey);
            return result ? JSON.parse(result.value) : null;
        };
    </script>

</body>

</html>